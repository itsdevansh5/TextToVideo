
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prompt2Video</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 10px;
    }

    textarea, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }

    button {
      cursor: pointer;
      font-weight: bold;
    }

    .job {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 12px;
      margin-top: 15px;
      background: #fafafa;
    }

    .job p {
      margin: 6px 0;
      font-size: 14px;
    }

    video {
      width: 100%;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>

<body>
  <h2>üé¨ Prompt2Video</h2>

  <textarea
    id="prompt"
    rows="4"
    placeholder="Describe the video you want to generate..."
  ></textarea>

  <select id="style">
    <option value="cinematic">Cinematic</option>
    <option value="animation">Animation</option>
    <option value="realistic">Realistic</option>
  </select>

  <button onclick="generateVideo()">Generate Video</button>

  <h3>Jobs</h3>
  <div id="jobs"></div>

  <script>
    const BACKEND_URL = "https://texttovideo-8ena.onrender.com";

    function createJobCard(jobId) {
      const jobDiv = document.createElement("div");
      jobDiv.className = "job";

      jobDiv.innerHTML = `
        <p><b>Job ID:</b> ${jobId}</p>
        <p class="status">Starting...</p>
        <video controls></video>
      `;

      document.getElementById("jobs").prepend(jobDiv);
      return jobDiv;
    }

    async function generateVideo() {
      const prompt = document.getElementById("prompt").value.trim();
      const style = document.getElementById("style").value;

      if (!prompt) {
        alert("Please enter a prompt");
        return;
      }

      let response;
      try {
        response = await fetch(`${BACKEND_URL}/generate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt, style })
        });
      } catch (err) {
        alert("Backend not reachable");
        return;
      }

      const data = await response.json();

      // Cached response
      if (data.cached) {
        const card = createJobCard("cached");
        card.querySelector(".status").innerText = "Loaded from cache";
        const video = card.querySelector("video");
        video.src = data.video_url;
        video.style.display = "block";
        return;
      }

      const jobId = data.job_id;
      const card = createJobCard(jobId);

      const statusEl = card.querySelector(".status");
      const videoEl = card.querySelector("video");

      statusEl.innerText = "Job created. Waiting for updates...";

      const pollInterval = setInterval(async () => {
        try {
          const res = await fetch(`${BACKEND_URL}/status/${jobId}`);
          const jobData = await res.json();

          if (jobData.message) {
            statusEl.innerText = jobData.message;
          }

          if (jobData.status === "done") {
            videoEl.src = jobData.video_url;
            videoEl.style.display = "block";
            statusEl.innerText = "Done üéâ";
            clearInterval(pollInterval);
          }

          if (jobData.status === "failed") {
            statusEl.innerText = "Failed ‚ùå";
            clearInterval(pollInterval);
          }
        } catch (err) {
          statusEl.innerText = "Error fetching status";
          clearInterval(pollInterval);
        }
      }, 3000);
    }
  </script>
</body>
</html>
